import { AttributeId } from "./Vocabulary.js";

/**
 * Attribute mastery trees: data-driven, validation-backed.
 *
 * Contract:
 * - Each node must have player-facing metadata (name/summary).
 * - Each node must bind to real runtime EffectDefs (via effectGroupId) with no placeholders.
 */

export const ActivationMode = Object.freeze({
  Always: "Always",
  Hybrid: "Hybrid",
  Attuned: "Attuned",
});

export const ATTRIBUTE_MASTERY_TREES = Object.freeze({
  [AttributeId.Might]: Object.freeze({
    attributeId: AttributeId.Might,
    nodes: Object.freeze([
      {
        id: "might_01_kindling",
        name: "Kindling",
        summary: "Your hits apply Ignite.",
        attributeId: AttributeId.Might,
        tier: 1,
        prereqs: [],
        exclusiveGroup: null,
        activationMode: ActivationMode.Always,
        tags: { attributeTag: AttributeId.Might },
        effectGroupId: "might_01_kindling",
      },
      {
        id: "might_02_deepen_ignite",
        name: "Deepen Ignite",
        summary: "Ignite is stronger.",
        attributeId: AttributeId.Might,
        tier: 2,
        prereqs: ["might_01_kindling"],
        exclusiveGroup: null,
        activationMode: ActivationMode.Always,
        tags: { attributeTag: AttributeId.Might },
        effectGroupId: "might_02_deepen_ignite",
      },
      {
        id: "might_03_hearth_regen",
        name: "Hearth Regen",
        summary: "Build Hearth near ignited foes to regenerate.",
        attributeId: AttributeId.Might,
        tier: 3,
        prereqs: ["might_02_deepen_ignite"],
        exclusiveGroup: null,
        activationMode: ActivationMode.Hybrid,
        tags: { attributeTag: AttributeId.Might },
        effectGroupId: "might_03_hearth_regen",
      },
      {
        id: "might_04_press_the_burn",
        name: "Press The Burn",
        summary: "Hitting ignited foes adds extra Ignite.",
        attributeId: AttributeId.Might,
        tier: 4,
        prereqs: ["might_03_hearth_regen"],
        exclusiveGroup: null,
        activationMode: ActivationMode.Always,
        tags: { attributeTag: AttributeId.Might },
        effectGroupId: "might_04_press_the_burn",
      },
      {
        id: "might_05a_phoenix_covenant",
        name: "Phoenix Covenant",
        summary: "Killing ignited foes can erupt in a phoenix burst.",
        attributeId: AttributeId.Might,
        tier: 5,
        prereqs: ["might_04_press_the_burn"],
        exclusiveGroup: "t5_might",
        activationMode: ActivationMode.Attuned,
        tags: { attributeTag: AttributeId.Might },
        effectGroupId: "might_05a_phoenix_covenant",
      },
      {
        id: "might_05b_sanctified_hearth",
        name: "Sanctified Hearth",
        summary: "Dashing consecrates the ground, burning nearby enemies.",
        attributeId: AttributeId.Might,
        tier: 5,
        prereqs: ["might_04_press_the_burn"],
        exclusiveGroup: "t5_might",
        activationMode: ActivationMode.Attuned,
        tags: { attributeTag: AttributeId.Might },
        effectGroupId: "might_05b_sanctified_hearth",
      },
      {
        id: "might_06_ember_spread",
        name: "Ember Spread",
        summary: "Ignited kills spread Ignite to nearby foes.",
        attributeId: AttributeId.Might,
        tier: 6,
        prereqs: ["might_04_press_the_burn"],
        exclusiveGroup: null,
        activationMode: ActivationMode.Hybrid,
        tags: { attributeTag: AttributeId.Might },
        effectGroupId: "might_06_ember_spread",
      },
      {
        id: "might_07_flames_of_hearth",
        name: "Flames Of Hearth",
        summary: "Hearth decays more slowly.",
        attributeId: AttributeId.Might,
        tier: 7,
        prereqs: ["might_06_ember_spread"],
        exclusiveGroup: null,
        activationMode: ActivationMode.Always,
        tags: { attributeTag: AttributeId.Might },
        effectGroupId: "might_07_flames_of_hearth",
      },
      {
        id: "might_08_ignite_mastery",
        name: "Ignite Mastery",
        summary: "Increase your Ignite stacks.",
        attributeId: AttributeId.Might,
        tier: 8,
        prereqs: ["might_07_flames_of_hearth"],
        exclusiveGroup: null,
        activationMode: ActivationMode.Always,
        tags: { attributeTag: AttributeId.Might },
        effectGroupId: "might_08_ignite_mastery",
      },
      {
        id: "might_10a_cinderstorm_moment",
        name: "Cinderstorm Moment",
        summary: "Elite kills ignite a wide area.",
        attributeId: AttributeId.Might,
        tier: 10,
        prereqs: ["might_08_ignite_mastery"],
        exclusiveGroup: "t10_might",
        activationMode: ActivationMode.Attuned,
        tags: { attributeTag: AttributeId.Might },
        effectGroupId: "might_10a_cinderstorm_moment",
      },
      {
        id: "might_10b_phoenix_rebirth",
        name: "Phoenix Rebirth",
        summary: "When low on health, consume Hearth to trigger a powerful recovery.",
        attributeId: AttributeId.Might,
        tier: 10,
        prereqs: ["might_08_ignite_mastery"],
        exclusiveGroup: "t10_might",
        activationMode: ActivationMode.Attuned,
        tags: { attributeTag: AttributeId.Might },
        effectGroupId: "might_10b_phoenix_rebirth",
      },
    ]),
  }),
  [AttributeId.Will]: Object.freeze({
    attributeId: AttributeId.Will,
    nodes: Object.freeze([
      {
        id: "will_01_soak",
        name: "Soak",
        summary: "Your hits apply Soaked.",
        attributeId: AttributeId.Will,
        tier: 1,
        prereqs: [],
        exclusiveGroup: null,
        activationMode: ActivationMode.Always,
        tags: { attributeTag: AttributeId.Will },
        effectGroupId: "will_01_soak",
      },
      {
        id: "will_02_undertow_drag",
        name: "Undertow Drag",
        summary: "Soaked enemies are easier to pull.",
        attributeId: AttributeId.Will,
        tier: 2,
        prereqs: ["will_01_soak"],
        exclusiveGroup: null,
        activationMode: ActivationMode.Always,
        tags: { attributeTag: AttributeId.Will },
        effectGroupId: "will_02_undertow_drag",
      },
      {
        id: "will_03_lunar_tide",
        name: "Lunar Tide",
        summary: "Soul orbs drift toward you.",
        attributeId: AttributeId.Will,
        tier: 3,
        prereqs: ["will_02_undertow_drag"],
        exclusiveGroup: null,
        activationMode: ActivationMode.Hybrid,
        tags: { attributeTag: AttributeId.Will },
        effectGroupId: "will_03_lunar_tide",
      },
      {
        id: "will_04_conductive_water",
        name: "Conductive Water",
        summary: "Repeated hits can apply Conductive.",
        attributeId: AttributeId.Will,
        tier: 4,
        prereqs: ["will_03_lunar_tide"],
        exclusiveGroup: null,
        activationMode: ActivationMode.Always,
        tags: { attributeTag: AttributeId.Will },
        effectGroupId: "will_04_conductive_water",
      },
      {
        id: "will_05a_whirlpool_curse",
        name: "Whirlpool Curse",
        summary: "Kills can spawn a Whirlpool.",
        attributeId: AttributeId.Will,
        tier: 5,
        prereqs: ["will_04_conductive_water"],
        exclusiveGroup: "t5_will",
        activationMode: ActivationMode.Attuned,
        tags: { attributeTag: AttributeId.Will },
        effectGroupId: "will_05a_whirlpool_curse",
      },
      {
        id: "will_05b_abyssal_tentacle",
        name: "Abyssal Tentacle",
        summary: "Periodically slam foes with a summoned tentacle.",
        attributeId: AttributeId.Will,
        tier: 5,
        prereqs: ["will_04_conductive_water"],
        exclusiveGroup: "t5_will",
        activationMode: ActivationMode.Attuned,
        tags: { attributeTag: AttributeId.Will },
        effectGroupId: "will_05b_abyssal_tentacle",
      },
      {
        id: "will_06_high_tide_window",
        name: "High Tide Window",
        summary: "Increase control durations during a short window.",
        attributeId: AttributeId.Will,
        tier: 6,
        prereqs: ["will_04_conductive_water"],
        exclusiveGroup: null,
        activationMode: ActivationMode.Hybrid,
        tags: { attributeTag: AttributeId.Will },
        effectGroupId: "will_06_high_tide_window",
      },
      {
        id: "will_07_tempest_conductor",
        name: "Tempest Conductor",
        summary: "Conductive triggers arcing control effects.",
        attributeId: AttributeId.Will,
        tier: 7,
        prereqs: ["will_06_high_tide_window"],
        exclusiveGroup: null,
        activationMode: ActivationMode.Always,
        tags: { attributeTag: AttributeId.Will },
        effectGroupId: "will_07_tempest_conductor",
      },
      {
        id: "will_08_moonbound_current",
        name: "Moonbound Current",
        summary: "Picking up souls empowers your Soak effects.",
        attributeId: AttributeId.Will,
        tier: 8,
        prereqs: ["will_07_tempest_conductor"],
        exclusiveGroup: null,
        activationMode: ActivationMode.Always,
        tags: { attributeTag: AttributeId.Will },
        effectGroupId: "will_08_moonbound_current",
      },
      {
        id: "will_10a_maelstrom",
        name: "Maelstrom",
        summary: "Upgrade Whirlpool into a major, single-target maelstrom.",
        attributeId: AttributeId.Will,
        tier: 10,
        prereqs: ["will_08_moonbound_current"],
        exclusiveGroup: "t10_will",
        activationMode: ActivationMode.Attuned,
        tags: { attributeTag: AttributeId.Will },
        effectGroupId: "will_10a_maelstrom",
      },
      {
        id: "will_10b_call_of_the_deep",
        name: "Call Of The Deep",
        summary: "Upgrade Tentacle into a signature attack.",
        attributeId: AttributeId.Will,
        tier: 10,
        prereqs: ["will_08_moonbound_current"],
        exclusiveGroup: "t10_will",
        activationMode: ActivationMode.Attuned,
        tags: { attributeTag: AttributeId.Will },
        effectGroupId: "will_10b_call_of_the_deep",
      },
    ]),
  }),
  [AttributeId.Alacrity]: Object.freeze({
    attributeId: AttributeId.Alacrity,
    nodes: Object.freeze([
      {
        id: "alac_01_windstep",
        name: "Windstep",
        summary: "Move a little faster.",
        attributeId: AttributeId.Alacrity,
        tier: 1,
        prereqs: [],
        exclusiveGroup: null,
        activationMode: ActivationMode.Always,
        tags: { attributeTag: AttributeId.Alacrity },
        effectGroupId: "alac_01_windstep",
      },
      {
        id: "alac_02_quickhands",
        name: "Quickhands",
        summary: "Attack a little faster.",
        attributeId: AttributeId.Alacrity,
        tier: 2,
        prereqs: ["alac_01_windstep"],
        exclusiveGroup: null,
        activationMode: ActivationMode.Always,
        tags: { attributeTag: AttributeId.Alacrity },
        effectGroupId: "alac_02_quickhands",
      },
      {
        id: "alac_03_gust_spacing",
        name: "Gust Spacing",
        summary: "Dashing releases a gust that pushes foes away.",
        attributeId: AttributeId.Alacrity,
        tier: 3,
        prereqs: ["alac_02_quickhands"],
        exclusiveGroup: null,
        activationMode: ActivationMode.Hybrid,
        tags: { attributeTag: AttributeId.Alacrity },
        effectGroupId: "alac_03_gust_spacing",
      },
      {
        id: "alac_04_guided_projectiles",
        name: "Guided Projectiles",
        summary: "Your projectiles slightly home toward targets.",
        attributeId: AttributeId.Alacrity,
        tier: 4,
        prereqs: ["alac_03_gust_spacing"],
        exclusiveGroup: null,
        activationMode: ActivationMode.Always,
        tags: { attributeTag: AttributeId.Alacrity },
        effectGroupId: "alac_04_guided_projectiles",
      },
      {
        id: "alac_05a_pinball_dash",
        name: "Pinball Dash",
        summary: "Dash can chain between nearby targets.",
        attributeId: AttributeId.Alacrity,
        tier: 5,
        prereqs: ["alac_04_guided_projectiles"],
        exclusiveGroup: "t5_alac",
        activationMode: ActivationMode.Attuned,
        tags: { attributeTag: AttributeId.Alacrity },
        effectGroupId: "alac_05a_pinball_dash",
      },
      {
        id: "alac_05b_gale_dancer",
        name: "Gale Dancer",
        summary: "Dashing builds momentum stacks that empower your movement.",
        attributeId: AttributeId.Alacrity,
        tier: 5,
        prereqs: ["alac_04_guided_projectiles"],
        exclusiveGroup: "t5_alac",
        activationMode: ActivationMode.Attuned,
        tags: { attributeTag: AttributeId.Alacrity },
        effectGroupId: "alac_05b_gale_dancer",
      },
      {
        id: "alac_06_extra_charge",
        name: "Extra Charge",
        summary: "Gain an extra dash charge and recharge faster.",
        attributeId: AttributeId.Alacrity,
        tier: 6,
        prereqs: ["alac_04_guided_projectiles"],
        exclusiveGroup: null,
        activationMode: ActivationMode.Hybrid,
        tags: { attributeTag: AttributeId.Alacrity },
        effectGroupId: "alac_06_extra_charge",
      },
      {
        id: "alac_07_slipstream",
        name: "Slipstream",
        summary: "While moving, gain a temporary speed buff.",
        attributeId: AttributeId.Alacrity,
        tier: 7,
        prereqs: ["alac_06_extra_charge"],
        exclusiveGroup: null,
        activationMode: ActivationMode.Always,
        tags: { attributeTag: AttributeId.Alacrity },
        effectGroupId: "alac_07_slipstream",
      },
      {
        id: "alac_08_windguard",
        name: "Windguard",
        summary: "After dashing, take reduced damage for a short time.",
        attributeId: AttributeId.Alacrity,
        tier: 8,
        prereqs: ["alac_07_slipstream"],
        exclusiveGroup: null,
        activationMode: ActivationMode.Always,
        tags: { attributeTag: AttributeId.Alacrity },
        effectGroupId: "alac_08_windguard",
      },
      {
        id: "alac_10a_cyclone_break",
        name: "Cyclone Break",
        summary: "Major gale procs disperse foes in a wide burst.",
        attributeId: AttributeId.Alacrity,
        tier: 10,
        prereqs: ["alac_08_windguard"],
        exclusiveGroup: "t10_alac",
        activationMode: ActivationMode.Attuned,
        tags: { attributeTag: AttributeId.Alacrity },
        effectGroupId: "alac_10a_cyclone_break",
      },
      {
        id: "alac_10b_perfect_cadence",
        name: "Perfect Cadence",
        summary: "Your first hit after dashing is guaranteed to trigger your on-hit proc.",
        attributeId: AttributeId.Alacrity,
        tier: 10,
        prereqs: ["alac_08_windguard"],
        exclusiveGroup: "t10_alac",
        activationMode: ActivationMode.Attuned,
        tags: { attributeTag: AttributeId.Alacrity },
        effectGroupId: "alac_10b_perfect_cadence",
      },
    ]),
  }),
  [AttributeId.Constitution]: Object.freeze({
    attributeId: AttributeId.Constitution,
    nodes: Object.freeze([
      {
        id: "con_01_ward_seed",
        name: "Ward Seed",
        summary: "Gain access to Ward.",
        attributeId: AttributeId.Constitution,
        tier: 1,
        prereqs: [],
        exclusiveGroup: null,
        activationMode: ActivationMode.Always,
        tags: { attributeTag: AttributeId.Constitution },
        effectGroupId: "con_01_ward_seed",
      },
      {
        id: "con_02_stonehide",
        name: "Stonehide",
        summary: "Take reduced damage.",
        attributeId: AttributeId.Constitution,
        tier: 2,
        prereqs: ["con_01_ward_seed"],
        exclusiveGroup: null,
        activationMode: ActivationMode.Always,
        tags: { attributeTag: AttributeId.Constitution },
        effectGroupId: "con_02_stonehide",
      },
      {
        id: "con_03_thorn_marrow",
        name: "Thorn Marrow",
        summary: "Thorns retaliate when you take damage.",
        attributeId: AttributeId.Constitution,
        tier: 3,
        prereqs: ["con_02_stonehide"],
        exclusiveGroup: null,
        activationMode: ActivationMode.Hybrid,
        tags: { attributeTag: AttributeId.Constitution },
        effectGroupId: "con_03_thorn_marrow",
      },
      {
        id: "con_04_bone_plating",
        name: "Bone Plating",
        summary: "Big hits can grant a temporary Bone Shield.",
        attributeId: AttributeId.Constitution,
        tier: 4,
        prereqs: ["con_03_thorn_marrow"],
        exclusiveGroup: null,
        activationMode: ActivationMode.Always,
        tags: { attributeTag: AttributeId.Constitution },
        effectGroupId: "con_04_bone_plating",
      },
      {
        id: "con_05a_wardweaver",
        name: "Wardweaver",
        summary: "Regenerate Ward over time.",
        attributeId: AttributeId.Constitution,
        tier: 5,
        prereqs: ["con_04_bone_plating"],
        exclusiveGroup: "t5_con",
        activationMode: ActivationMode.Attuned,
        tags: { attributeTag: AttributeId.Constitution },
        effectGroupId: "con_05a_wardweaver",
      },
      {
        id: "con_05b_bone_mirror",
        name: "Bone Mirror",
        summary: "While Bone Shield is active, reflect projectiles.",
        attributeId: AttributeId.Constitution,
        tier: 5,
        prereqs: ["con_04_bone_plating"],
        exclusiveGroup: "t5_con",
        activationMode: ActivationMode.Attuned,
        tags: { attributeTag: AttributeId.Constitution },
        effectGroupId: "con_05b_bone_mirror",
      },
      {
        id: "con_06_more_ward",
        name: "More Ward",
        summary: "Increase Ward capacity.",
        attributeId: AttributeId.Constitution,
        tier: 6,
        prereqs: ["con_04_bone_plating"],
        exclusiveGroup: null,
        activationMode: ActivationMode.Always,
        tags: { attributeTag: AttributeId.Constitution },
        effectGroupId: "con_06_more_ward",
      },
      {
        id: "con_07_splinterburst",
        name: "Splinterburst",
        summary: "Thorns can trigger a splintering burst.",
        attributeId: AttributeId.Constitution,
        tier: 7,
        prereqs: ["con_06_more_ward"],
        exclusiveGroup: null,
        activationMode: ActivationMode.Hybrid,
        tags: { attributeTag: AttributeId.Constitution },
        effectGroupId: "con_07_splinterburst",
      },
      {
        id: "con_08_granite_oath",
        name: "Granite Oath",
        summary: "While Ward is high, gain extra mitigation.",
        attributeId: AttributeId.Constitution,
        tier: 8,
        prereqs: ["con_07_splinterburst"],
        exclusiveGroup: null,
        activationMode: ActivationMode.Always,
        tags: { attributeTag: AttributeId.Constitution },
        effectGroupId: "con_08_granite_oath",
      },
      {
        id: "con_10a_fortress_protocol",
        name: "Fortress Protocol",
        summary: "When Ward breaks, refill and become unstoppable briefly.",
        attributeId: AttributeId.Constitution,
        tier: 10,
        prereqs: ["con_08_granite_oath"],
        exclusiveGroup: "t10_con",
        activationMode: ActivationMode.Attuned,
        tags: { attributeTag: AttributeId.Constitution },
        effectGroupId: "con_10a_fortress_protocol",
      },
      {
        id: "con_10b_break_upon_me",
        name: "Break Upon Me",
        summary: "While Ward is active, your thorns are stronger.",
        attributeId: AttributeId.Constitution,
        tier: 10,
        prereqs: ["con_08_granite_oath"],
        exclusiveGroup: "t10_con",
        activationMode: ActivationMode.Attuned,
        tags: { attributeTag: AttributeId.Constitution },
        effectGroupId: "con_10b_break_upon_me",
      },
    ]),
  }),
});
